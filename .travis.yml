---
sudo: required
language: python
python:
  - 3.8
services: docker

before_install:
  - sudo apt-get -qq update

env:
  global:
    - COLLECTION_NAMESPACE: ripclawffb
    - COLLECTION_NAME: helix_core
  matrix:
    - MOLECULE_DISTRO: default

install:
  # Install test dependencies.
  #- python3 -m pip install molecule ansible-lint docker
  # - wget -O /tmp/p4api-glibc2.12-openssl1.0.2.tgz https://cdist2.perforce.com/perforce/r19.1/bin.linux26x86_64/p4api-glibc2.12-openssl1.0.2.tgz
  # - tar -xvzf /tmp/p4api-glibc2.12-openssl1.0.2.tgz -C /tmp
  - python3 -m pip install p4python --install-option="--apidir='/tmp/p4api-2019.1.1927394'"
  # - curl https://package.perforce.com/perforce.pubkey | sudo apt-key add -
  # - echo "deb http://package.perforce.com/apt/ubuntu/ xenial release" | sudo tee -a /etc/apt/sources.list
  # - sudo echo "deb http://package.perforce.com/apt/ubuntu/ xenial release" > /etc/apt/sources.list.d/perforce.list
  # - wget -qO - https://package.perforce.com/perforce.pubkey | sudo apt-key add -
  # - sudo apt-get update
  # - sudo apt install perforce-p4python3
  - python3 -m pip install pipenv
  - pipenv install

before_script:
  # Move the collection into the required path.
  - cd ../
  - mkdir -p ansible_collections/$COLLECTION_NAMESPACE
  - mv ansible-collection-${COLLECTION_NAME/_/-} ansible_collections/$COLLECTION_NAMESPACE/$COLLECTION_NAME
  - cd ansible_collections/$COLLECTION_NAMESPACE/$COLLECTION_NAME

script:
  # Test helix modules
  - molecule test
